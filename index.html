<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rastgele Sohbet - Çalışan Örnek</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin:0; padding:0; height:100vh;
    display:flex; flex-direction:column;
  }
  #chatContainer {
    flex-grow:1;
    padding: 10px;
    overflow-y: auto;
    background: #eee;
  }
  .message {
    margin-bottom: 8px;
    padding: 8px 12px;
    border-radius: 12px;
    max-width: 70%;
    word-wrap: break-word;
  }
  .self {
    background: #4caf50;
    color: white;
    align-self: flex-end;
  }
  .other {
    background: #ddd;
    color: #333;
    align-self: flex-start;
  }
  #inputArea {
    display: flex;
    padding: 10px;
    border-top: 1px solid #ccc;
    background: white;
  }
  #msgInput {
    flex-grow: 1;
    padding: 10px;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 20px;
    outline: none;
  }
  #sendBtn {
    margin-left: 8px;
    padding: 10px 18px;
    font-size: 1rem;
    background: #4caf50;
    border: none;
    color: white;
    border-radius: 20px;
    cursor: pointer;
  }
  #sendBtn:hover {
    background: #388e3c;
  }
</style>
</head>
<body>
  <div id="chatContainer"></div>

  <form id="inputArea" autocomplete="off">
    <input type="text" id="msgInput" placeholder="Mesajınızı yazın..." required />
    <button type="submit" id="sendBtn">Gönder</button>
  </form>

  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <script>
    const socket = io();

    const chatContainer = document.getElementById('chatContainer');
    const inputArea = document.getElementById('inputArea');
    const msgInput = document.getElementById('msgInput');

    // Mesaj ekleme fonksiyonu
    function addMessage(text, isSelf) {
      const div = document.createElement('div');
      div.classList.add('message');
      div.classList.add(isSelf ? 'self' : 'other');
      div.textContent = text;
      div.style.alignSelf = isSelf ? 'flex-end' : 'flex-start';
      chatContainer.appendChild(div);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    socket.on('connect', () => {
      addMessage('Sohbete bağlandınız.', true);
    });

    socket.on('chat message', data => {
      // Eğer mesaj gönderen bizsek, self olarak göster, değilse other.
      const isSelf = data.senderId === socket.id;
      addMessage(data.message, isSelf);
    });

    socket.on('system', msg => {
      addMessage(`[Sistem] ${msg}`, false);
    });

    socket.on('full', msg => {
      alert(msg);
    });

    inputArea.addEventListener('submit', e => {
      e.preventDefault();
      const message = msgInput.value.trim();
      if (!message) return;
      socket.emit('chat message', message);
      msgInput.value = '';
      msgInput.focus();
    });
  </script>
</body>
</html>
